<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Document Vault — AI Accountant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Shared theme, Bootstrap, Bootstrap Icons, helpers -->
  <script>window.__API_BASE = window.__API_BASE || 'https://ai-accountant-app.onrender.com';</script>
  <script src="/js/head-include.js"></script>
  <!-- Removed http-shim.js (was 404) -->

  <style>
    :root{
      /* Match landing look & feel */
      --tile-gap: 14px;
      --tile-radius: 16px;
      --tile-shadow: 0 10px 30px rgba(0,0,0,.06), 0 2px 8px rgba(0,0,0,.06);
      --tile-shadow-hover: 0 14px 34px rgba(0,0,0,.10), 0 4px 12px rgba(0,0,0,.06);
      --muted: #6b7280;
      --brand: var(--bs-primary, #6f42c1);
      --chip-bg: rgba(111,66,193,.08);
      --chip-fg: var(--brand);
      --bg-soft: var(--bs-light-bg-subtle, #f8f9fa);
    }

    body{ background: var(--bg-body); color: var(--fg); }

    /* Page header */
    .page-header{ position:relative; border-radius: 20px; padding: 18px 18px; background: linear-gradient(180deg, rgba(111,66,193,.10), rgba(111,66,193,.02)); border:1px solid var(--bs-border-color); box-shadow: var(--tile-shadow); }
    .breadcrumbs a{ text-decoration:none }

    /* Stat tiles */
    .stat-card{ border-radius: var(--tile-radius); box-shadow: var(--tile-shadow); border:1px solid var(--bs-border-color); transition: .2s ease; background: var(--bs-body-bg) }
    .stat-card:hover{ box-shadow: var(--tile-shadow-hover); transform: translateY(-1px) }
    .stat-k{ font-weight:700; font-size: 1.3rem; }
    .stat-sub{ color: var(--muted); font-size: .9rem }

    /* Layout */
    .vault-grid{ display:grid; grid-template-columns: 1fr 1.2fr; gap: var(--tile-gap) }
    @media (max-width: 992px){ .vault-grid{ grid-template-columns: 1fr } }

    /* Left column (collections) */
    .panel{ border-radius: var(--tile-radius); border: 1px solid var(--bs-border-color); background: var(--bs-body-bg); box-shadow: var(--tile-shadow); }
    .panel-header{ padding: 14px 16px; border-bottom: 1px solid var(--bs-border-color); display:flex; align-items:center; justify-content:space-between; gap:10px }
    .panel-body{ padding: 10px }

    .collection-item{ display:flex; align-items:center; gap:10px; padding: 10px 12px; border-radius: 12px; cursor:pointer; user-select:none; border:1px solid transparent; }
    .collection-item:hover{ background: var(--bg-soft); border-color: var(--bs-border-color); }
    .collection-item.active{ background: rgba(111,66,193,.08); border-color: rgba(111,66,193,.25) }
    .collection-name{ font-weight:600 }
    .collection-meta{ color: var(--muted); font-size:.88rem }
    .scroll-area{ max-height: 48vh; overflow:auto; padding-right: 4px }

    /* Right column: PANEL (opens when a collection is selected) */
    #panel{ display:none; border-radius: var(--tile-radius); border:1px solid var(--bs-border-color); box-shadow: var(--tile-shadow); overflow:hidden; background: var(--bs-body-bg) }
    #panel.show{ display:block }
    #panel .panel-title{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--bs-border-color) }
    #panel .panel-body{ padding: 12px }

    .file-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 10px 12px; border-radius: 12px; border:1px solid transparent }
    .file-item:hover{ background: var(--bg-soft); border-color: var(--bs-border-color) }

    /* Dropzone + preview inside panel */
    .dropzone-card{ border-radius: var(--tile-radius); border: 1px dashed rgba(111,66,193,.35); background: linear-gradient(180deg, rgba(111,66,193,.06), rgba(111,66,193,.02)); box-shadow: var(--tile-shadow); padding: 12px }
    #dropzone{ border: 2px dashed rgba(111,66,193,.45); border-radius: 16px; padding: 0; background: rgba(111,66,193,.04); overflow:hidden }
    #dropzone .dz-clickable-area{ padding: 24px; display:flex; align-items:center; justify-content:space-between; gap:10px }

    .preview-card{ border-radius: var(--tile-radius); border: 1px solid var(--bs-border-color); box-shadow: var(--tile-shadow); overflow:hidden; }
    .preview-header{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom: 1px solid var(--bs-border-color) }
    .preview-body{ background: #fff; height: 420px; }
    .preview-body iframe{ width:100%; height:100%; border:0 }

    .muted{ color: var(--muted) }
    .search-input{ background: var(--bs-body-bg) }
  </style>
</head>
<body>
  <div id="topbar-container"></div>
  <div id="sidebar-container"></div>

  <main class="container-xxl py-4">

    <!-- Header / Breadcrumbs -->
    <div class="page-header mb-3">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div>
          <h1 class="h3 mb-1">Document Vault</h1>
          <div class="breadcrumbs small">
            <a href="/home.html" class="text-body"><i class="bi bi-house-door"></i> Home</a>
            <span class="mx-1">/</span>
            <span class="text-body">Vault</span>
          </div>
        </div>
        <div class="d-flex align-items-center gap-3">
          <div class="stat-sub text-end">
            <div class="small text-muted">Files</div>
            <div class="stat-k" id="m-files">0</div>
          </div>
          <div class="stat-sub text-end">
            <div class="small text-muted">Storage used</div>
            <div class="stat-k" id="m-storage">0</div>
          </div>
          <div class="stat-sub text-end">
            <div class="small text-muted">Last updated</div>
            <div class="stat-k" id="m-updated">—</div>
          </div>
        </div>
      </div>
    </div>

    <div class="vault-grid">
      <!-- LEFT: collections list (shown by default) -->
      <section id="collections-section" class="panel">
        <div class="panel-header">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-collection text-primary"></i>
            <strong>Collections</strong>
          </div>
          <div class="d-flex align-items-center gap-2">
            <div class="input-group input-group-sm">
              <span class="input-group-text bg-transparent border-end-0"><i class="bi bi-search"></i></span>
              <input id="collection-search" class="form-control border-start-0 search-input" placeholder="Search collections…" />
            </div>
            <button id="btn-new-col" type="button" class="btn btn-sm btn-primary">
              <i class="bi bi-folder-plus"></i> New
            </button>
          </div>
        </div>
        <div class="panel-body">
          <div id="collections" class="scroll-area"></div>
          <div id="collections-empty" class="text-muted small" style="display:none">No collections yet.</div>
        </div>
      </section>

      <!-- RIGHT: panel with files + upload + preview; hidden until a collection is opened -->
      <section id="panel">
        <div class="panel-title">
          <div class="d-flex align-items-center gap-2">
            <button id="btn-back" class="btn btn-sm btn-light"><i class="bi bi-arrow-left"></i></button>
            <strong id="panel-name">Collection</strong>
          </div>
        </div>
        <div class="panel-body">
          <!-- Dropzone -->
          <div class="dropzone-card mb-3">
            <form id="dropzone" class="dropzone bg-white" action="#" method="post" enctype="multipart/form-data">
              <div class="dz-clickable-area w-100">
                <div class="d-flex align-items-center gap-2">
                  <i class="bi bi-cloud-arrow-up"></i>
                  <span class="small text-muted">Drop PDFs here or click to upload</span>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <button id="btn-browse" type="button" class="btn btn-primary btn-sm">
                    <i class="bi bi-upload me-1"></i> Browse
                  </button>
                </div>
              </div>
              <input id="file-input" name="files" type="file" multiple accept="application/pdf" class="d-none" />
            </form>
          </div>

          <!-- Files list (rendered by JS) -->
          <div id="file-list" class="scroll-area mb-3"></div>

          <!-- Preview under dropzone, next to files in wide screens -->
          <div class="preview-card">
            <div class="preview-header">
              <div class="d-flex align-items-center gap-2">
                <i class="bi bi-eye text-primary"></i>
                <strong>Preview</strong>
              </div>
              <div class="small text-muted" id="preview-filename">—</div>
            </div>
            <div class="preview-body">
              <div class="h-100 d-flex align-items-center justify-content-center text-muted" id="preview-empty">Select a document to preview</div>
              <iframe id="preview-frame" class="d-none" title="Preview"></iframe>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Scripts required by your page logic (order matters) -->
  <script src="/js/nav.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/document-vault.js"></script>
  <script>
    // Small UX helpers; do NOT replace your logic
    (function(){
      const fi = document.getElementById('file-input');
      const btn = document.getElementById('btn-browse');
      if (btn && fi) btn.addEventListener('click', () => fi.click());

      // Mirror preview name when iframe is set by your JS
      const frame = document.getElementById('preview-frame');
      frame?.addEventListener('load', () => {
        const nameEl = document.getElementById('preview-filename');
        if (nameEl && frame?.src) {
          try { nameEl.textContent = new URL(frame.src).pathname.split('/').pop() || '—'; } catch {}
        }
      });
    })();
  </script>
</body>
</html>
