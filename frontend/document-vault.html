<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Vault — AI Accountant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/styles.css" fetchpriority="high">
  <script>window.__API_BASE = window.__API_BASE || '';</script>
  <script src="/js/head-include.js"></script>
  <script src="/js/auth.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.Auth && typeof Auth.enforce === 'function') {
        Auth.enforce({ validateWithServer: true }).catch(() => {});
      }
    });
  </script>
</head>
<body class="page-vault">
  <div id="topbar-container"></div>
  <div id="sidebar-container"></div>

  <main class="app-main">
    <header class="app-section-header">
      <h1>Smart Document Vault</h1>
      <p class="lede">Upload payslips, statements, ISA and investment reports, pensions, and HMRC correspondence. We classify, extract, and surface insights automatically.</p>
    </header>

    <section class="vault-progress app-card" id="vault-progress" hidden aria-hidden="true">
      <div class="vault-progress__meta">
        <span class="vault-progress__phase" id="vault-progress-phase">Preparing uploads…</span>
        <span class="vault-progress__count" id="vault-progress-count"></span>
      </div>
      <div class="vault-progress__bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="vault-progress__fill" id="vault-progress-bar"></div>
      </div>
    </section>

    <section class="upload-layout">
      <div class="app-card dropzone-card">
        <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload PDF or ZIP">
          <input id="file-input" type="file" accept="application/pdf,application/zip" />
          <div>
            <div class="headline">Drop PDF or ZIP</div>
            <p class="hint">We accept payslips, bank statements, ISA &amp; investment reports, pension statements, and HMRC letters (P60, P45, Self Assessment).</p>
            <p class="hint" id="collection-target" hidden>Uploads will be saved to <strong></strong>.</p>
            <small class="hint">Per-user isolation is enforced; files never leave your R2 bucket.</small>
          </div>
        </div>
      </div>

      <aside class="app-card session-panel" id="session-panel" aria-live="polite">
        <div class="session-panel__header">
          <div>
            <h2>Upload session</h2>
            <p class="session-empty" id="session-empty">No files queued yet. Start by dragging in a PDF or ZIP.</p>
          </div>
          <div class="session-actions" id="session-actions" hidden>
            <button type="button" class="session-clear-btn" id="session-clear">
              <i class="bi bi-x-circle"></i>
              <span>Clear history</span>
            </button>
          </div>
        </div>
        <div class="session-reminder" id="session-reminder" hidden></div>
        <div class="session-table" id="session-rows" role="list"></div>
      </aside>
    </section>

    <section class="tiles-grid" id="tiles-grid" aria-live="polite"></section>

    <section class="listing" id="payslips-section">
      <header class="app-section-header">
        <h2>Payslips</h2>
        <span class="muted" id="payslip-meta"></span>
      </header>
      <div class="grid" id="payslip-grid"></div>
    </section>

    <section class="listing" id="statements-section">
      <header class="app-section-header">
        <h2>Statements</h2>
        <span class="muted" id="statement-meta"></span>
      </header>
      <div class="grid" id="statement-grid"></div>
    </section>

    <section class="listing" id="collections-section">
      <header class="app-section-header">
        <h2>My Collections</h2>
        <span class="muted" id="collection-meta"></span>
      </header>
      <div class="grid" id="collection-grid"></div>
    </section>
  </main>

  <div class="viewer" id="file-viewer" aria-hidden="true">
    <div class="viewer__overlay" id="file-viewer-overlay"></div>
    <section class="viewer__panel" role="dialog" aria-modal="true" aria-labelledby="file-viewer-title">
      <header class="viewer__header">
        <div>
          <h3 class="viewer__title" id="file-viewer-title">Documents</h3>
          <p class="viewer__subtitle" id="file-viewer-subtitle"></p>
        </div>
        <button type="button" class="viewer__close" id="file-viewer-close">Close</button>
      </header>
      <div class="viewer__body">
        <div class="viewer__list" id="file-viewer-list" role="list"></div>
        <div class="viewer__preview">
          <div class="viewer__frame-shell">
            <iframe title="Document preview" id="file-viewer-frame" class="viewer__iframe" src="about:blank"></iframe>
          </div>
          <div class="viewer__empty" id="file-viewer-empty">Select a file to see the preview and actions.</div>
        </div>
      </div>
    </section>
  </div>

  <script src="/js/vault.js"></script>
  <script src="/js/nav.js"></script>
  <script src="/js/mobile-sidebar.js"></script>
</body>
</html>
