<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AI Accountant — Secure Document Vault</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/styles.css" fetchpriority="high">
  <script>window.__API_BASE = window.__API_BASE || 'http://localhost:3000';</script>
  <script src="/js/head-include.js"></script>

  <style>
    body { background: var(--bg-body); color: var(--fg); min-height: 100vh; }
    .vault-nav {
      position: sticky;
      top: 0;
      z-index: 1020;
      backdrop-filter: saturate(1.25) blur(16px);
      background: linear-gradient(140deg,
        color-mix(in srgb, var(--bg-surface) 92%, transparent),
        color-mix(in srgb, var(--bg-surface-2) 88%, transparent));
      border-bottom: 1px solid color-mix(in srgb, var(--bd-hairline) 70%, transparent);
      box-shadow: 0 18px 36px rgba(8, 25, 33, 0.12);
    }
    .vault-nav .brand-mark { text-decoration: none; color: inherit; display: flex; align-items: center; gap: .65rem; }
    .vault-nav .brand-dot {
      width: 16px;
      height: 16px;
      border-radius: 6px;
      background: linear-gradient(140deg, var(--brand) 0%, color-mix(in srgb, var(--brand-hover) 50%, white) 100%);
      box-shadow: 0 10px 18px rgba(0, 194, 168, 0.3);
    }
    .vault-main { padding: clamp(2.5rem, 5vw, 4rem) 0 5rem; }
    .vault-upload-card, .vault-table-card { border-radius: 20px; border: 1px solid var(--bd-hairline); box-shadow: var(--shadow); background: var(--bg-surface); }
    .vault-upload-card h1 { font-size: clamp(1.8rem, 3vw, 2.6rem); margin-bottom: .75rem; }
    .vault-dropzone {
      border: 2px dashed color-mix(in srgb, var(--bd) 80%, transparent);
      border-radius: 18px;
      padding: clamp(1.5rem, 4vw, 2.5rem);
      text-align: center;
      background: color-mix(in srgb, var(--bg-surface-2) 50%, transparent);
      transition: border-color .2s ease, background .2s ease, transform .2s ease;
      cursor: pointer;
    }
    .vault-dropzone.dragover {
      border-color: color-mix(in srgb, var(--brand) 60%, transparent);
      background: color-mix(in srgb, var(--brand) 12%, transparent);
      transform: translateY(-1px);
    }
    .vault-dropzone input[type="file"] { display: none; }
    .vault-upload-queue { margin-top: 1.25rem; display: grid; gap: .75rem; }
    .vault-upload-item { padding: .85rem 1rem; border-radius: 14px; background: var(--bg-surface-2); border: 1px solid color-mix(in srgb, var(--bd-hairline) 70%, transparent); }
    .vault-upload-item.is-error { border-color: var(--danger); background: color-mix(in srgb, var(--danger) 10%, var(--bg-surface-2)); }
    .vault-upload-item .file-name { font-weight: 600; }
    .vault-upload-item small { color: var(--fg-3); }
    .vault-status-chips { gap: .35rem; }
    .vault-status-chips .badge { font-weight: 500; letter-spacing: .01em; }
    .vault-table-card .table { color: inherit; }
    .vault-table-card thead th { border-color: color-mix(in srgb, var(--bd-hairline) 80%, transparent); font-size: .85rem; text-transform: uppercase; letter-spacing: .06em; }
    .vault-table-card tbody td { vertical-align: middle; border-color: color-mix(in srgb, var(--bd-hairline) 60%, transparent); }
    .vault-empty { padding: 3rem 1rem; text-align: center; color: var(--fg-2); }
    .vault-empty i { font-size: 2.5rem; margin-bottom: 1rem; color: color-mix(in srgb, var(--brand) 40%, var(--fg-2)); }
    .vault-actions .btn { min-width: 44px; }
    .placeholder-row td { padding: .9rem 1rem; }
    .placeholder-pill { display: inline-block; height: 12px; border-radius: 999px; background: color-mix(in srgb, var(--bg-surface-2) 70%, var(--bg-surface)); }
    .toast-container { z-index: 2000; }
    @media (max-width: 991.98px) {
      .vault-upload-card, .vault-table-card { border-radius: 16px; }
      .vault-nav .nav-actions { width: 100%; justify-content: space-between; margin-top: .75rem; }
    }
    @media (max-width: 575.98px) {
      .vault-main { padding-top: 2.5rem; }
    }
  </style>
</head>
<body>
  <header class="vault-nav py-3">
    <div class="container-xl d-flex flex-wrap align-items-center gap-3">
      <a class="brand-mark" href="#">
        <span class="brand-dot"></span>
        <span class="fw-semibold">AI Accountant</span>
      </a>
      <div class="ms-auto d-flex flex-wrap align-items-center gap-3 nav-actions">
        <span class="text-secondary" id="vault-user-greeting">Loading…</span>
        <button class="btn btn-outline-secondary btn-sm" id="vault-refresh" type="button">
          <i class="bi bi-arrow-clockwise me-1"></i> Refresh
        </button>
        <button class="btn btn-primary btn-sm" id="vault-upload-trigger" type="button">
          <i class="bi bi-upload me-1"></i> Upload files
        </button>
        <button class="btn btn-outline-danger btn-sm" id="vault-signout" type="button">
          <i class="bi bi-box-arrow-right me-1"></i> Sign out
        </button>
      </div>
    </div>
  </header>

  <main class="vault-main">
    <div class="container-xl">
      <div class="row g-4">
        <div class="col-12">
          <div class="card vault-upload-card">
            <div class="card-body p-4 p-lg-5">
              <div class="d-flex flex-column flex-lg-row gap-3 align-items-start align-items-lg-center justify-content-between mb-4">
                <div>
                  <h1 class="mb-2">Secure document vault</h1>
                  <p class="text-secondary mb-0">Store bank statements, payslips, and financial files securely with Cloudflare R2. Upload PDFs or ZIP archives and we’ll handle the rest.</p>
                </div>
                <div class="text-secondary small d-flex align-items-center gap-2">
                  <i class="bi bi-shield-lock"></i>
                  AES-GCM encrypted at rest · Tenant-isolated access
                </div>
              </div>
              <label class="vault-dropzone" id="vault-dropzone">
                <input id="vault-file-input" type="file" accept=".pdf,application/pdf,.zip,application/zip" multiple>
                <div class="d-flex flex-column align-items-center gap-2">
                  <div class="rounded-circle d-flex align-items-center justify-content-center" style="width:68px;height:68px;background:color-mix(in srgb, var(--brand) 14%, white); color: var(--brand);">
                    <i class="bi bi-cloud-arrow-up-fill fs-3"></i>
                  </div>
                  <div>
                    <strong>Drop files here</strong> or click to browse
                  </div>
                  <small class="text-secondary">PDFs up to 75&nbsp;MB each, or ZIP archives of PDFs.</small>
                </div>
              </label>
              <div id="vault-upload-queue" class="vault-upload-queue" hidden></div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card vault-table-card">
            <div class="card-header bg-transparent border-0 px-4 pt-4 pb-3 d-flex flex-wrap gap-2 align-items-center justify-content-between">
              <div>
                <h2 class="h4 mb-0">Document history</h2>
                <p class="text-secondary mb-0">Track processing progress and download your files at any time.</p>
              </div>
              <div class="d-flex align-items-center gap-2">
                <button class="btn btn-outline-secondary btn-sm" type="button" id="vault-load-more" hidden>Load more</button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table align-middle mb-0">
                  <thead>
                    <tr>
                      <th scope="col" class="px-4">Filename</th>
                      <th scope="col">Uploaded</th>
                      <th scope="col">Size</th>
                      <th scope="col">Pipeline</th>
                      <th scope="col" class="text-end pe-4">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="vault-table-body"></tbody>
                </table>
              </div>
              <div id="vault-empty" class="vault-empty d-none">
                <i class="bi bi-inboxes"></i>
                <h3 class="h5">No documents yet</h3>
                <p class="mb-0">Upload a PDF or ZIP to begin building your secure archive.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <div class="toast-container position-fixed top-0 end-0 p-3" id="vault-toasts"></div>

  <script src="/js/auth.js"></script>
  <script src="/js/vault-app.js"></script>
</body>
</html>
