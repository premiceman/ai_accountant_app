<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document Vault ¬∑ AI Accountant</title>
  <link rel="stylesheet" href="/app/css/app.css" />
  <script defer src="/app/js/app.js"></script>
  <script defer src="/app/js/document-vault.js"></script>
</head>
<body>
  <div class="app-shell">
    <nav>
      <h1>AI ACCOUNTANT</h1>
      <a data-nav="dashboard" href="/app/dashboard">Dashboard</a>
      <a data-nav="vault" href="/app/document-vault">Document Vault</a>
      <a data-nav="profile" href="/app/profile">Profile</a>
      <button class="signout" type="button" data-action="signout">Sign out</button>
    </nav>
    <main>
      <div class="page-header">
        <div>
          <span class="badge">Welcome back</span>
          <h2 data-user-name>‚Äî</h2>
          <p class="subtitle">Upload payslips and bank statements to unlock monthly insights.</p>
        </div>
      </div>

      <section class="card upload-card" aria-live="polite">
        <div class="panel-header">
          <div>
            <h3>Document upload</h3>
            <p class="subtitle">Documents are stored in your secure R2 vault and processed through Docupipe.</p>
          </div>
        </div>
        <form id="upload-form" class="upload-form" novalidate>
          <input id="document-input" class="visually-hidden" type="file" accept="application/pdf" />
          <div id="upload-dropzone" class="upload-dropzone" tabindex="0">
            <div class="dropzone-content">
              <div class="dropzone-icon">üìÑ</div>
              <p class="dropzone-title">Drag &amp; drop a PDF here, or</p>
              <button type="button" class="button" id="document-button">Select PDF</button>
              <p class="dropzone-subtitle">Supported: payslips and bank statements (.pdf, max 20&nbsp;MB)</p>
            </div>
          </div>
        </form>
        <ul class="status-list" id="upload-status">
          <li class="status-item" data-step="upload">
            <span class="status-icon" aria-hidden="true"></span>
            <span class="status-label">Uploading to Cloudflare R2</span>
          </li>
          <li class="status-item" data-step="docupipe">
            <span class="status-icon" aria-hidden="true"></span>
            <span class="status-label">Running Docupipe workflow</span>
          </li>
          <li class="status-item" data-step="analytics">
            <span class="status-icon" aria-hidden="true"></span>
            <span class="status-label">Saving analytics</span>
          </li>
        </ul>
        <div class="upload-feedback" id="upload-feedback" role="status"></div>
      </section>

      <section class="card source-card" aria-live="polite">
        <div class="panel-header source-header">
          <div>
            <h3>Document sources</h3>
            <p class="subtitle">Grouped by employer and bank/building society so you can spot missing periods.</p>
          </div>
          <div class="source-header__actions">
            <button type="button" class="button button--ghost" id="add-employer-btn">+ Add employer</button>
            <button type="button" class="button" id="add-bank-btn">+ Add bank</button>
          </div>
        </div>

        <div class="source-form" id="source-form-card" hidden>
          <div class="source-form__header">
            <div>
              <p class="badge">New source</p>
              <h4 id="source-form-title">Add employer</h4>
              <p class="subtitle">Save source metadata so uploads stay organised.</p>
            </div>
            <button class="button button--ghost" type="button" id="source-cancel" data-cancel-source="true" aria-label="Close add source form">Cancel</button>
          </div>
          <form id="source-form" class="source-form__body">
            <div class="form-grid">
              <label>
                <span class="label">Type</span>
                <select id="source-type" name="type">
                  <option value="payslip">Payslip ¬∑ Employer</option>
                  <option value="statement">Statement ¬∑ Bank or building society</option>
                </select>
              </label>
              <label>
                <span class="label">Name</span>
                <input id="source-name" name="name" type="text" placeholder="e.g. ACME Ltd or NatWest" required />
              </label>
              <label>
                <span class="label">Institution (optional)</span>
                <input id="source-institution" name="institution" type="text" placeholder="Building society or bank" />
              </label>
              <label>
                <span class="label">Account number (optional)</span>
                <input id="source-account-number" name="accountNumber" type="text" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
              </label>
            </div>
            <p class="form-feedback" id="source-form-feedback"></p>
            <div class="source-form__actions">
              <button type="button" class="button button--ghost" data-cancel-source="true" aria-label="Cancel add source">Cancel</button>
              <button type="submit" class="button">Save source</button>
            </div>
          </form>
        </div>

        <div class="source-groups">
          <div class="source-group">
            <div class="source-group__header">
              <div class="source-chip source-chip--payslip">üè¢</div>
              <div>
                <h4>Payslip sources</h4>
                <p class="subtitle">Employers providing payslips.</p>
              </div>
            </div>
            <div class="source-grid" id="payslip-source-grid"></div>
            <p class="empty-indicator" id="payslip-sources-empty">No employers added yet. Add one to start tracking coverage.</p>
          </div>
          <div class="source-group">
            <div class="source-group__header">
              <div class="source-chip source-chip--statement">üè¶</div>
              <div>
                <h4>Bank &amp; building society sources</h4>
                <p class="subtitle">Accounts you upload statements for.</p>
              </div>
            </div>
            <div class="source-grid" id="statement-source-grid"></div>
            <p class="empty-indicator" id="statement-sources-empty">Add your first bank or building society to track statements.</p>
          </div>
        </div>
      </section>

      <section class="card document-preview-card" aria-live="polite">
        <div class="panel-header">
          <div>
            <h3>Uploaded documents</h3>
            <p class="subtitle">Select a document to preview the PDF and inspect the JSON output returned by Docupipe.</p>
          </div>
        </div>
        <div class="document-preview-body">
          <div class="document-preview-list">
            <p class="empty-indicator" id="document-list-empty">No documents uploaded yet.</p>
            <ul id="document-list"></ul>
          </div>
          <div class="document-preview-panels">
            <div class="document-preview-header">
              <div class="document-preview-heading">
                <h4 id="document-preview-title">No documents available</h4>
                <p class="document-preview-meta" id="document-preview-meta"></p>
              </div>
              <div class="document-preview-actions">
                <button type="button" class="button button--ghost" id="document-download" disabled>
                  Download
                </button>
                <button type="button" class="button button--ghost" id="document-delete" disabled>
                  Delete
                </button>
              </div>
              <div class="document-preview-tags" id="document-preview-tags" hidden></div>
            </div>
            <div class="document-preview-pane document-preview-pane--pdf">
              <div class="document-preview-pane-header">
                <div class="document-preview-pane-title">PDF preview</div>
              </div>
              <div class="document-preview-frame-wrapper">
                <iframe id="document-preview-frame" title="Uploaded document preview" hidden loading="lazy"></iframe>
                <div class="document-preview-empty" id="document-preview-empty">Upload a document to preview it here.</div>
              </div>
            </div>
            <div class="document-preview-pane document-preview-pane--json">
              <div class="document-preview-pane-header">
                <div class="document-preview-pane-title">JSON output</div>
                <div class="document-preview-actions">
                  <button type="button" class="button button--ghost" id="document-json-copy" disabled>Copy JSON</button>
                </div>
              </div>
              <div class="document-json-wrapper">
                <pre id="document-json" hidden></pre>
                <div class="document-preview-empty" id="document-json-empty">Upload a document to view JSON output.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="card analytics-card">
        <div class="panel-header">
          <div>
            <h3>Monthly analytics</h3>
            <p class="subtitle">Select a month to view consolidated payslip and statement metrics.</p>
          </div>
          <div class="month-select">
            <label for="analytics-month">Month</label>
            <select id="analytics-month" name="analytics-month"></select>
          </div>
        </div>
        <div class="analytics-loading" id="analytics-loading" hidden>
          <span class="loading-spinner" aria-hidden="true"></span>
          <span>Loading analytics‚Ä¶</span>
        </div>
        <div class="summary-grid" id="summary-grid"></div>
        <p class="empty-indicator" id="summary-empty" hidden>No analytics are available yet. Upload a payslip or bank statement to get started.</p>
      </section>

      <div class="card-grid">
        <section class="card" id="payslip-panel">
          <div class="panel-header">
            <div>
              <h3>Payslips</h3>
              <p class="subtitle">Net pay, tax and deductions for the selected month.</p>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="table" id="payslip-table">
              <thead>
                <tr>
                  <th scope="col">Employer</th>
                  <th scope="col">Pay date</th>
                  <th scope="col">Gross</th>
                  <th scope="col">Net</th>
                  <th scope="col">Income tax</th>
                  <th scope="col">NI</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <p class="empty-indicator" id="payslip-empty" hidden>No payslips processed for this month yet.</p>
        </section>

        <section class="card" id="statement-panel">
          <div class="panel-header">
            <div>
              <h3>Bank statements</h3>
              <p class="subtitle">Track income, spend and cashflow from your accounts.</p>
            </div>
          </div>
          <div class="table-wrapper">
            <table class="table" id="statement-table">
              <thead>
                <tr>
                  <th scope="col">Account</th>
                  <th scope="col">Opening</th>
                  <th scope="col">Closing</th>
                  <th scope="col">Income</th>
                  <th scope="col">Spend</th>
                  <th scope="col">Net</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="top-transactions" id="statement-top" hidden>
            <h4>Top transactions</h4>
            <ul id="transaction-list"></ul>
          </div>
          <p class="empty-indicator" id="statement-empty" hidden>No statements processed for this month yet.</p>
        </section>
      </div>
    </main>
  </div>
</body>
</html>
