<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard — AI Accountant</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js (vanilla). We’re not using React, so this keeps deps light. -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>
  <div id="navbar-container"></div>
  <main class="container py-4">
    <h1 class="page-title" data-page-title>Dashboard</h1>

    <!-- Greeting -->
    <div class="alert alert-light border d-flex justify-content-between align-items-center">
      <div>Welcome, <strong id="greeting-name">—</strong>.</div>
      <div class="text-muted small" id="dash-year">Tax year —</div>
    </div>

    <!-- Tiles row 1: Waterfall + EMTR -->
    <div class="row g-3 mb-3">
      <div class="col-12 col-lg-7">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="card-title m-0">Take-home Waterfall</h5>
              <button class="btn btn-sm btn-outline-secondary" id="wf-details">View why</button>
            </div>
            <canvas id="chart-waterfall" height="140"></canvas>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-5">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title">EMTR (Effective marginal tax rate)</h5>
            <canvas id="chart-emtr" height="140"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Tiles row 2: Gauges + Events -->
    <div class="row g-3">
      <div class="col-12 col-lg-7">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title">Allowance usage</h5>
            <div id="gauges" class="row g-3">
              <!-- dynamic gauge tiles injected here -->
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-5">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title">Upcoming events</h5>
            <ul id="events-list" class="list-group list-group-flush">
              <!-- dynamic event items injected here -->
            </ul>
            <div id="events-empty" class="text-muted small">No upcoming events yet.</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Load navbar -->
  <script>(async()=>{ try{ const r=await fetch('./components/navbar.html',{cache:'no-store'}); if(r.ok) document.getElementById('navbar-container').innerHTML = await r.text(); }catch{} })();</script>

  <!-- Core scripts (config first, then auth, then dashboard) -->
  <script src="./js/config.js"></script>
  <script src="./js/auth.js"></script>
  <script>Auth.enforce();</script>
  <script src="./js/dashboard.js"></script>
</body>
</html>
